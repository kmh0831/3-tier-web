<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTT Movie Service</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 상단 네비게이션 바 -->
    <nav class="navbar">
        <div class="logo">OTT Movie Service</div>
        <ul class="nav-links">
            <li><a href="#">Home</a></li>
            <li><a href="#">Search</a></li>
            <li><a href="#">Watchlist</a></li>
            <li><a href="#">Movies</a></li>
            <li><a href="#">Series</a></li>
        </ul>
        <div class="profile">My Profile</div>
    </nav>

    <!-- 상단 포스터 슬라이더 -->
    <section class="slider">
        <div class="slide-show">
            <img class="slides" id="image1" alt="Movie 1">
            <img class="slides" id="image2" alt="Movie 2">
            <img class="slides" id="image3" alt="Movie 3">
            <img class="slides" id="image4" alt="Movie 4">
        </div>
    </section>

    <!-- 영화 카테고리 섹션 (DB에서 동적으로 받아오기) -->
    <section class="movie-section">
        <h2>Originals</h2>
        <div class="movie-grid" id="movie-grid">
            <!-- 영화 목록이 JavaScript에 의해 여기에 동적으로 추가됨 -->
        </div>
    </section>

    <!-- JavaScript 파일 참조 -->
    <script src="%PUBLIC_URL%/scripts.js"></script>
    <script>
        // 백엔드에서 영화 목록을 가져와서 동적으로 추가하는 함수
        function fetchMovies() {
            fetch('http://13.125.70.251:5000/api/movies')
                .then(response => response.json())
                .then(movies => {
                    const movieGrid = document.getElementById('movie-grid');
                    movieGrid.innerHTML = '';  // 기존 내용 초기화
                    movies.forEach(movie => {
                        const movieItem = document.createElement('div');
                        movieItem.classList.add('movie-item');

                        const img = document.createElement('img');
                        img.src = movie.poster_url;
                        img.alt = movie.title;

                        const title = document.createElement('p');
                        title.textContent = movie.title;

                        movieItem.appendChild(img);
                        movieItem.appendChild(title);

                        movieGrid.appendChild(movieItem);
                    });
                })
                .catch(error => console.error('영화 목록을 가져오는 중 오류 발생:', error));
        }

        // 프리사인드 URL을 갱신하는 함수
        function fetchPresignedUrls() {
            fetch('/api/getPresignedUrls')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('image1').src = data.urls[0];
                    document.getElementById('image2').src = data.urls[1];
                    document.getElementById('image3').src = data.urls[2];
                    document.getElementById('image4').src = data.urls[3];
                })
                .catch(error => console.error('프리사인드 URL을 가져오는 중 오류 발생:', error));
        }

        // 페이지 로드 시 영화 목록과 프리사인드 URL 갱신
        document.addEventListener('DOMContentLoaded', () => {
            fetchMovies();  // 영화 목록 로드
            fetchPresignedUrls();  // 슬라이드 이미지 갱신
        });

        // 30분마다 프리사인드 URL 갱신
        setInterval(fetchPresignedUrls, 1800000); // 30분 주기
    </script>
</body>
</html>
